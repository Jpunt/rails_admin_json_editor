<%
  name = locals[:field].name
  id = "#{name}-record-picker"
  records = locals[:field].picker_records
%>

<div id="<%= id %>" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3>Kies <%= name %></h3>
  </div>

  <div class="modal-body">
    <select v-model="selectedRecord" placeholder="Zoeken">
      <option value=""></option>
      <% records.each do |record| %>
        <option value="<%= record.to_json %>"><%= record.upload_file_name %></option>
      <% end %>
    </select>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal">Sluiten</button>
    <button v-on="click:submit" class="btn btn-primary">Opslaan</button>
  </div>
</div>

<script type="text/javascript">
  recordPickers['<%= name %>'] = new Vue({
    el: '#<%= id %>',
    data: {
      componentIndex: null,
      selectedRecord: null
    },
    methods: {
      show: function(componentIndex) {
        this.componentIndex = componentIndex;
        this.selectedRecord = null;
        $('#<%= id %>').modal();
      },
      submit: function(e) {
        e.preventDefault();
        var values = JSON.parse(this.selectedRecord)

        if(values) {
          componentsVM.components[this.componentIndex].props = values
          $('#<%= id %>').modal('hide');
        }
      }
    }
  })
</script>
