<%= javascript_include_tag "rails_admin_json_editor/rails_admin_json_editor.js" %>

<div ref="components_json" class="components_json" data-json="<%= raw(field.value.empty? ? "[]" : field.value) %>">
  <!-- List content -->
  <div v-repeat="components" class="component">
    <% field.components.each do |component| %>
      <div v-if="type == '<%= component.type %>'">
        <legend><%= component.label %></legend>
        <%= content_tag :p, component.help, class: "help-block" unless component.help.nil? %>

        <% component.fields.each do |f| %>
          <div class="control-group">
            <%= label_tag f.name, f.label, class: "control-label" %>

            <div class="controls">
              <% if f.type == :string %>
                <%= text_field_tag f.name, nil, 'v-model' => "props.#{f.name}" %>
              <% end %>

              <% if f.type == :text %>
                <%= text_area_tag f.name, nil, 'v-model' => "props.#{f.name}" %>
              <% end %>

              <% if f.type == :picker %>
                <select v-on="change: onChangePicker($event, $index, '<%= f.name %>')" placeholder="Zoeken">
                  <option value=""></option>
                  <% f.picker_records.each do |record| %>
                    <option
                      v-attr="selected: pickerOptionIsSelected(this, '<%= f.name %>', '<%= f.picker_label %>', '<%= record.send(f.picker_label) %>')"
                      value="<%= record.send(f.picker_label) %>"
                      data-json="<%= record.to_json %>">
                        <%= record.send(f.picker_label) %>
                    </option>
                  <% end %>
                </select>
              <% end %>

              <%= content_tag :p, f.help, class: "help-block" unless f.help.nil? %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Dropdown to add new content -->
  <div class="dropdown">
    <a class="dropdown-toggle btn btn-info" data-toggle="dropdown" href="#">Component toevoegen <b class="caret"></b></a>

    <ul class="dropdown-menu">
      <% field.components.each do |component| %>
        <li><a href="#" v-on="click: addComponent" component-type="<%= component.type %>"><%= component.type %></a></li>
      <% end %>
    </ul>
  </div>

  <!-- Hidden field to store JSON -->
  <%= form.text_area field.name, 'v-model' => 'components | json', cols:50, rows:10, style: 'margin-top:40px' %>
</div>
